import{useState as e,createContext as t,useRef as a,useCallback as i,useLayoutEffect as n,createElement as r,useEffect as o,useMemo as s}from"react";import{and as l}from"mendix/filters/builders";var c,d={exports:{}};
/*!
  Copyright (c) 2017 Jed Watson.
  Licensed under the MIT License (MIT), see
  http://jedwatson.github.io/classnames
*/c=d,function(){var e={}.hasOwnProperty;function t(){for(var a=[],i=0;i<arguments.length;i++){var n=arguments[i];if(n){var r=typeof n;if("string"===r||"number"===r)a.push(n);else if(Array.isArray(n)&&n.length){var o=t.apply(null,n);o&&a.push(o)}else if("object"===r)for(var s in n)e.call(n,s)&&n[s]&&a.push(s)}}return a.join(" ")}c.exports?(t.default=t,c.exports=t):window.classNames=t}();var g,u=d.exports;function m(){const e=window["com.mendix.widgets.web.filterable.filterContext"];if(e)return{FilterContext:e};const a=t(void 0);return window["com.mendix.widgets.web.filterable.filterContext"]=a,{FilterContext:a}}function p(){const e=window["com.mendix.widgets.web.sortable.sortContext"];if(e)return{SortContext:e};const a=t(void 0);return window["com.mendix.widgets.web.sortable.sortContext"]=a,{SortContext:a}}function f(t){const[o,s]=e(0),l=a(null),c=i((e=>{Math.floor(e.target.scrollHeight-e.target.scrollTop)===Math.floor(e.target.clientHeight)&&t.hasMoreItems&&t.setPage&&t.setPage((e=>e+1))}),[t.hasMoreItems,t.setPage]),d=i((()=>{t.isInfinite&&t.hasMoreItems&&o<=0&&l.current&&s(l.current.clientHeight-30)}),[t.isInfinite,t.hasMoreItems,o]);return n((()=>{setTimeout((()=>d()),100)}),[d]),r("div",Object.assign({ref:l},t,{className:u(t.className,t.isInfinite?"infinite-loading":""),onScroll:t.isInfinite?c:void 0,style:t.isInfinite&&o>0?Object.assign(Object.assign({},t.style),{maxHeight:o}):t.style}),t.children)}function v(e){var t;const a=void 0!==e.numberOfItems?Math.ceil(e.numberOfItems/e.pageSize):void 0,i=void 0!==a?a-1:0,n=void 0!==a,o=e.page*e.pageSize+1,s=e.canNextPage||!e.numberOfItems?(e.page+1)*e.pageSize:e.numberOfItems,l=t=>{e.setPaginationIndex&&e.setPaginationIndex(t)};return 0===e.numberOfItems?null:r("div",{className:"pagination-bar"},r("button",Object.assign({className:"btn pagination-button",disabled:0===e.page},b((()=>{e.gotoPage(0),l(0)}))),r("span",{className:"glyphicon glyphicon-step-backward"})),r("button",Object.assign({className:"btn pagination-button",disabled:!e.canPreviousPage},b((()=>{e.previousPage(),l(e.page-1)}))),r("span",{className:"glyphicon glyphicon-backward"})),r("div",{className:"paging-status"},o," to ",s," ",n?"of ".concat(null!==(t=e.numberOfItems)&&void 0!==t?t:(null!=a?a:1)*e.pageSize):""),r("button",Object.assign({className:"btn pagination-button",disabled:!e.canNextPage},b((()=>{e.nextPage(),l(e.page+1)}))),r("span",{className:"glyphicon glyphicon-forward"})),n&&r("button",Object.assign({className:"btn pagination-button",disabled:e.page===i},b((()=>{e.gotoPage(i),l(i)}))),r("span",{className:"glyphicon glyphicon-step-forward"})))}function b(e){return{onClick:e,onKeyDown:t=>{" "!==t.key&&"Enter"!==t.key||(t.preventDefault(),t.stopPropagation(),e())}}}function h(e){const t=e.paging?r("div",{className:"widget-gallery-pagination"},r(v,{canNextPage:e.hasMoreItems,canPreviousPage:0!==e.page,gotoPage:t=>e.setPage&&e.setPage((()=>t)),nextPage:()=>e.setPage&&e.setPage((e=>e+1)),numberOfItems:e.numberOfItems,page:e.page,pageSize:e.pageSize,previousPage:()=>e.setPage&&e.setPage((e=>e-1))})):null;return r("div",{className:u("widget-gallery",e.className),"data-focusindex":e.tabIndex||0},"above"===e.paginationPosition&&t,r("div",{className:"widget-gallery-filter"},e.filters),e.items.length>0&&e.itemRenderer&&r(f,{className:u("widget-gallery-items","widget-gallery-lg-".concat(e.desktopItems),"widget-gallery-md-".concat(e.tabletItems),"widget-gallery-sm-".concat(e.phoneItems)),hasMoreItems:e.hasMoreItems,setPage:e.setPage,isInfinite:!e.paging},e.items.map((t=>e.itemRenderer(((e,a,i)=>r("div",{key:"item_".concat(t),className:u("widget-gallery-item",a,{"widget-gallery-clickable":!!i}),onClick:i,onKeyDown:i?e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),i())}:void 0,role:i?"button":void 0,tabIndex:i?0:void 0},e)),t)))),(0===e.items.length||e.preview)&&e.emptyPlaceholderRenderer&&e.emptyPlaceholderRenderer((e=>r("div",{className:"widget-gallery-empty"},r("div",{className:"empty-placeholder"},e)))),"below"===e.paginationPosition&&t)}function y(e,t){if(!e||!t)return[];const a=I(t);return a?a.filter((e=>!!e.arg1&&!!e.arg2)).filter((t=>"attribute"===t.arg1.type&&t.arg1.attributeId===e.id)).map((e=>({type:String(e.name),value:e.arg2.value}))):[]}function I(e){return!e||"function"!==e.type||"and"!==e.name&&"or"!==e.name?e?[e]:void 0:e.args.flatMap(I).filter((e=>void 0!==e))}function P(t){var n,c;const d=a(void 0),g=a(void 0),[u,f]=e(!1),[v,b]=e(!1),I={string:e(),number:e(),date:e(),enum:e()},[P,w]=e(),{FilterContext:x}=m(),{SortContext:N}=p(),S="virtualScrolling"===t.pagination,O=S?t.datasource.limit/t.pageSize:t.datasource.offset/t.pageSize;o((()=>{t.datasource.requestTotalCount(!0),t.datasource.limit===Number.POSITIVE_INFINITY&&t.datasource.setLimit(t.pageSize)}),[t.datasource,t.pageSize]),o((()=>{!t.datasource.filter||u||d.current||(d.current=t.datasource.filter),!t.datasource.sortOrder||v||g.current||(g.current=t.datasource.sortOrder)}),[t.datasource,u,v]);const C=s((()=>t.filterList.reduce(((e,{filter:t})=>({...e,[t.id]:t})),{})),[t.filterList]),k=s((()=>t.sortList.map((({attribute:e,caption:t})=>{var a;return{attribute:e,caption:null!==(a=t.value)&&void 0!==a?a:""}}))),[t.sortList]),z=s((()=>t.filterList.reduce(((e,{filter:t})=>({...e,[t.id]:y(t,d.current)})),{})),[t.filterList,d.current]),M=Object.keys(I).map((e=>{var t;return null===(t=I[e][0])||void 0===t?void 0:t.getFilterCondition()})).filter((e=>void 0!==e));if(M.length>0?t.datasource.setFilter(M.length>1?l(...M):M[0]):u?t.datasource.setFilter(void 0):t.datasource.setFilter(d.current),P&&"getSortCondition"in P){const e=P.getSortCondition();t.datasource.setSortOrder(e?[e]:void 0)}else t.datasource.setSortOrder(void 0);const j=t.filterList.length>0||t.sortList.length>0,L=i((e=>{const a=e(O);S?t.datasource.setLimit(a*t.pageSize):t.datasource.setOffset(a*t.pageSize)}),[t.datasource,t.pageSize,S,O]);return r(h,{className:t.class,desktopItems:t.desktopItems,emptyPlaceholderRenderer:i((e=>"custom"===t.showEmptyPlaceholder?e(t.emptyPlaceholder):r("div",null)),[t.emptyPlaceholder,t.showEmptyPlaceholder]),filters:s((()=>j?r(x.Provider,{value:{filterDispatcher:e=>{if(e.filterType){const[,t]=I[e.filterType];t(e),f(!0)}return e},multipleAttributes:C,multipleInitialFilters:z}},r(N.Provider,{value:{sortDispatcher:e=>(b(!0),w(e),e),attributes:k,initialSort:g.current}},t.filtersPlaceholder)):null),[x,N,I,C,z,j,t.filtersPlaceholder,k]),hasMoreItems:null!==(n=t.datasource.hasMoreItems)&&void 0!==n&&n,items:null!==(c=t.datasource.items)&&void 0!==c?c:[],itemRenderer:i(((e,a)=>{var i,n,r;return e(t.content.get(a),null===(n=null===(i=t.itemClass)||void 0===i?void 0:i.get(a))||void 0===n?void 0:n.value,t.onClick?null===(r=t.onClick)||void 0===r?void 0:r.get(a).execute:void 0)}),[t.content,t.itemClass,t.onClick]),numberOfItems:t.datasource.totalCount,page:O,pageSize:t.pageSize,paging:"buttons"===t.pagination,paginationPosition:t.pagingPosition,phoneItems:t.phoneItems,setPage:L,tabletItems:t.tabletItems,tabIndex:t.tabIndex})}!function(e){e.Number="number",e.DateTime="datetime"}(g||(g={}));export{P as Gallery};
