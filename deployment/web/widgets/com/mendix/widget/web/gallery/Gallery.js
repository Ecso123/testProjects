define(["exports","react","mendix/filters/builders"],(function(e,t,a){"use strict";var i,n={exports:{}};
/*!
    Copyright (c) 2017 Jed Watson.
    Licensed under the MIT License (MIT), see
    http://jedwatson.github.io/classnames
  */i=n,function(){var e={}.hasOwnProperty;function t(){for(var a=[],i=0;i<arguments.length;i++){var n=arguments[i];if(n){var r=typeof n;if("string"===r||"number"===r)a.push(n);else if(Array.isArray(n)&&n.length){var s=t.apply(null,n);s&&a.push(s)}else if("object"===r)for(var o in n)e.call(n,o)&&n[o]&&a.push(o)}}return a.join(" ")}i.exports?(t.default=t,i.exports=t):window.classNames=t}();var r,s=n.exports;function o(){const e=window["com.mendix.widgets.web.filterable.filterContext"];if(e)return{FilterContext:e};const a=t.createContext(void 0);return window["com.mendix.widgets.web.filterable.filterContext"]=a,{FilterContext:a}}function l(){const e=window["com.mendix.widgets.web.sortable.sortContext"];if(e)return{SortContext:e};const a=t.createContext(void 0);return window["com.mendix.widgets.web.sortable.sortContext"]=a,{SortContext:a}}function c(e){const[a,i]=t.useState(0),n=t.useRef(null),r=t.useCallback((t=>{Math.floor(t.target.scrollHeight-t.target.scrollTop)===Math.floor(t.target.clientHeight)&&e.hasMoreItems&&e.setPage&&e.setPage((e=>e+1))}),[e.hasMoreItems,e.setPage]),o=t.useCallback((()=>{e.isInfinite&&e.hasMoreItems&&a<=0&&n.current&&i(n.current.clientHeight-30)}),[e.isInfinite,e.hasMoreItems,a]);return t.useLayoutEffect((()=>{setTimeout((()=>o()),100)}),[o]),t.createElement("div",Object.assign({ref:n},e,{className:s(e.className,e.isInfinite?"infinite-loading":""),onScroll:e.isInfinite?r:void 0,style:e.isInfinite&&a>0?Object.assign(Object.assign({},e.style),{maxHeight:a}):e.style}),e.children)}function u(e){var a;const i=void 0!==e.numberOfItems?Math.ceil(e.numberOfItems/e.pageSize):void 0,n=void 0!==i?i-1:0,r=void 0!==i,s=e.page*e.pageSize+1,o=e.canNextPage||!e.numberOfItems?(e.page+1)*e.pageSize:e.numberOfItems,l=t=>{e.setPaginationIndex&&e.setPaginationIndex(t)};return 0===e.numberOfItems?null:t.createElement("div",{className:"pagination-bar"},t.createElement("button",Object.assign({className:"btn pagination-button",disabled:0===e.page},d((()=>{e.gotoPage(0),l(0)}))),t.createElement("span",{className:"glyphicon glyphicon-step-backward"})),t.createElement("button",Object.assign({className:"btn pagination-button",disabled:!e.canPreviousPage},d((()=>{e.previousPage(),l(e.page-1)}))),t.createElement("span",{className:"glyphicon glyphicon-backward"})),t.createElement("div",{className:"paging-status"},s," to ",o," ",r?"of ".concat(null!==(a=e.numberOfItems)&&void 0!==a?a:(null!=i?i:1)*e.pageSize):""),t.createElement("button",Object.assign({className:"btn pagination-button",disabled:!e.canNextPage},d((()=>{e.nextPage(),l(e.page+1)}))),t.createElement("span",{className:"glyphicon glyphicon-forward"})),r&&t.createElement("button",Object.assign({className:"btn pagination-button",disabled:e.page===n},d((()=>{e.gotoPage(n),l(n)}))),t.createElement("span",{className:"glyphicon glyphicon-step-forward"})))}function d(e){return{onClick:e,onKeyDown:t=>{" "!==t.key&&"Enter"!==t.key||(t.preventDefault(),t.stopPropagation(),e())}}}function g(e){const a=e.paging?t.createElement("div",{className:"widget-gallery-pagination"},t.createElement(u,{canNextPage:e.hasMoreItems,canPreviousPage:0!==e.page,gotoPage:t=>e.setPage&&e.setPage((()=>t)),nextPage:()=>e.setPage&&e.setPage((e=>e+1)),numberOfItems:e.numberOfItems,page:e.page,pageSize:e.pageSize,previousPage:()=>e.setPage&&e.setPage((e=>e-1))})):null;return t.createElement("div",{className:s("widget-gallery",e.className),"data-focusindex":e.tabIndex||0},"above"===e.paginationPosition&&a,t.createElement("div",{className:"widget-gallery-filter"},e.filters),e.items.length>0&&e.itemRenderer&&t.createElement(c,{className:s("widget-gallery-items","widget-gallery-lg-".concat(e.desktopItems),"widget-gallery-md-".concat(e.tabletItems),"widget-gallery-sm-".concat(e.phoneItems)),hasMoreItems:e.hasMoreItems,setPage:e.setPage,isInfinite:!e.paging},e.items.map((a=>e.itemRenderer(((e,i,n)=>t.createElement("div",{key:"item_".concat(a),className:s("widget-gallery-item",i,{"widget-gallery-clickable":!!n}),onClick:n,onKeyDown:n?e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),n())}:void 0,role:n?"button":void 0,tabIndex:n?0:void 0},e)),a)))),(0===e.items.length||e.preview)&&e.emptyPlaceholderRenderer&&e.emptyPlaceholderRenderer((e=>t.createElement("div",{className:"widget-gallery-empty"},t.createElement("div",{className:"empty-placeholder"},e)))),"below"===e.paginationPosition&&a)}function m(e,t){if(!e||!t)return[];const a=p(t);return a?a.filter((e=>!!e.arg1&&!!e.arg2)).filter((t=>"attribute"===t.arg1.type&&t.arg1.attributeId===e.id)).map((e=>({type:String(e.name),value:e.arg2.value}))):[]}function p(e){return!e||"function"!==e.type||"and"!==e.name&&"or"!==e.name?e?[e]:void 0:e.args.flatMap(p).filter((e=>void 0!==e))}!function(e){e.Number="number",e.DateTime="datetime"}(r||(r={})),e.Gallery=function(e){var i,n;const r=t.useRef(void 0),s=t.useRef(void 0),[c,u]=t.useState(!1),[d,p]=t.useState(!1),f={string:t.useState(),number:t.useState(),date:t.useState(),enum:t.useState()},[b,v]=t.useState(),{FilterContext:h}=o(),{SortContext:y}=l(),P="virtualScrolling"===e.pagination,I=P?e.datasource.limit/e.pageSize:e.datasource.offset/e.pageSize;t.useEffect((()=>{e.datasource.requestTotalCount(!0),e.datasource.limit===Number.POSITIVE_INFINITY&&e.datasource.setLimit(e.pageSize)}),[e.datasource,e.pageSize]),t.useEffect((()=>{!e.datasource.filter||c||r.current||(r.current=e.datasource.filter),!e.datasource.sortOrder||d||s.current||(s.current=e.datasource.sortOrder)}),[e.datasource,c,d]);const w=t.useMemo((()=>e.filterList.reduce(((e,{filter:t})=>({...e,[t.id]:t})),{})),[e.filterList]),x=t.useMemo((()=>e.sortList.map((({attribute:e,caption:t})=>{var a;return{attribute:e,caption:null!==(a=t.value)&&void 0!==a?a:""}}))),[e.sortList]),S=t.useMemo((()=>e.filterList.reduce(((e,{filter:t})=>({...e,[t.id]:m(t,r.current)})),{})),[e.filterList,r.current]),E=Object.keys(f).map((e=>{var t;return null===(t=f[e][0])||void 0===t?void 0:t.getFilterCondition()})).filter((e=>void 0!==e));if(E.length>0?e.datasource.setFilter(E.length>1?a.and(...E):E[0]):c?e.datasource.setFilter(void 0):e.datasource.setFilter(r.current),b&&"getSortCondition"in b){const t=b.getSortCondition();e.datasource.setSortOrder(t?[t]:void 0)}else e.datasource.setSortOrder(void 0);const C=e.filterList.length>0||e.sortList.length>0,N=t.useCallback((t=>{const a=t(I);P?e.datasource.setLimit(a*e.pageSize):e.datasource.setOffset(a*e.pageSize)}),[e.datasource,e.pageSize,P,I]);return t.createElement(g,{className:e.class,desktopItems:e.desktopItems,emptyPlaceholderRenderer:t.useCallback((a=>"custom"===e.showEmptyPlaceholder?a(e.emptyPlaceholder):t.createElement("div",null)),[e.emptyPlaceholder,e.showEmptyPlaceholder]),filters:t.useMemo((()=>C?t.createElement(h.Provider,{value:{filterDispatcher:e=>{if(e.filterType){const[,t]=f[e.filterType];t(e),u(!0)}return e},multipleAttributes:w,multipleInitialFilters:S}},t.createElement(y.Provider,{value:{sortDispatcher:e=>(p(!0),v(e),e),attributes:x,initialSort:s.current}},e.filtersPlaceholder)):null),[h,y,f,w,S,C,e.filtersPlaceholder,x]),hasMoreItems:null!==(i=e.datasource.hasMoreItems)&&void 0!==i&&i,items:null!==(n=e.datasource.items)&&void 0!==n?n:[],itemRenderer:t.useCallback(((t,a)=>{var i,n,r;return t(e.content.get(a),null===(n=null===(i=e.itemClass)||void 0===i?void 0:i.get(a))||void 0===n?void 0:n.value,e.onClick?null===(r=e.onClick)||void 0===r?void 0:r.get(a).execute:void 0)}),[e.content,e.itemClass,e.onClick]),numberOfItems:e.datasource.totalCount,page:I,pageSize:e.pageSize,paging:"buttons"===e.pagination,paginationPosition:e.pagingPosition,phoneItems:e.phoneItems,setPage:N,tabletItems:e.tabletItems,tabIndex:e.tabIndex})},Object.defineProperty(e,"__esModule",{value:!0})}));
